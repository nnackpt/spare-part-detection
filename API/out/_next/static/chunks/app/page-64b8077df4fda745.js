(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6415:(e,t,l)=>{"use strict";l.d(t,{default:()=>s});var n=l(5155),r=l(2115),a=l(5704);function o(){var e;return(null!=(e=a.env.NEXT_PUBLIC_API_BASE)?e:"http://localhost:8000").replace(/\/+$/,"")}function s(){let e=(0,r.useMemo)(o,[]),t="".concat(e,"/stream.mjpg"),l=(0,r.useMemo)(()=>{let t=new URL(e);return t.protocol="https:"===t.protocol?"wss:":"ws:",t.pathname="/ws",t.toString()},[e]),a=(0,r.useRef)(null),s=(0,r.useRef)(null),[c,i]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null),[x,f]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[g,w]=(0,r.useState)([]),[b,p]=(0,r.useState)([]);(0,r.useEffect)(()=>{h(new Date);let e=setInterval(()=>h(new Date),1e3);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{let e=a.current;if(!e)return;let t=()=>{i(!0),f(!1),u(null)},l=()=>{i(!1),f(!1),u("Cannot connect to camera stream")};return e.addEventListener("load",t),e.addEventListener("error",l),()=>{e.removeEventListener("load",t),e.removeEventListener("error",l)}},[]),(0,r.useEffect)(()=>{let e,t=!0,n=()=>{let r=new WebSocket(l);s.current=r,r.onopen=()=>{console.log("✅ WebSocket connected")},r.onmessage=e=>{try{let t=JSON.parse(e.data);if(!("error"in t)&&t.detections){p(t.detections);let e=Array.from(new Set(t.detections.map(e=>e.label)));w(e)}}catch(e){console.error("Failed to parse WS message:",e)}},r.onerror=()=>{console.error("WebSocket error")},r.onclose=l=>{t&&1e3!==l.code&&(e=setTimeout(()=>{t&&n()},3e3))}};return n(),()=>{var l;t=!1,e&&clearTimeout(e),null==(l=s.current)||l.close(1e3)}},[l]);let v=(0,r.useMemo)(()=>m?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",month:"2-digit",day:"2-digit",year:"numeric"}).format(m):null,[m]),k=(0,r.useMemo)(()=>m?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(m):null,[m]);v&&k&&"".concat(v,"●").concat(k);let j=b.length>0?b[0]:null;return(0,n.jsxs)("main",{className:"min-h-screen w-full text-gray-100 flex p-4 pt-20 gap-4 bg-[#ffffff]",children:[(0,n.jsx)("div",{className:"flex-[2] flex flex-col",children:(0,n.jsx)("div",{className:"relative h-full rounded-2xl overflow-hidden border border-gray-200 bg-black shadow-sm",children:(0,n.jsx)("img",{ref:a,src:t,alt:"Live camera feed",className:"w-full h-full object-contain"})})}),(0,n.jsx)("div",{className:"flex-1 flex flex-col h-full justify-center py-12",children:(0,n.jsxs)("div",{className:"flex flex-col gap-6 h-full max-h-[90%]",children:[(0,n.jsxs)("div",{className:"p-8 flex flex-col justify-center items-center flex-1 rounded-3xl shadow-xl w-full transition-colors duration-300 ".concat(j?"bg-emerald-600":"bg-emerald-600/90"),children:[(0,n.jsx)("span",{className:"text-xl font-bold uppercase tracking-widest block mb-6 ".concat(j?"text-emerald-100":"text-white/70"),children:"Location"}),(0,n.jsx)("div",{className:"text-8xl xl:text-9xl font-black leading-tight break-words text-center ".concat(j?"text-white":"text-white/50"),children:j?j.label:"-"})]}),(0,n.jsxs)("div",{className:"p-8 flex flex-col justify-center items-center flex-1 rounded-3xl shadow-xl w-full transition-colors duration-300 ".concat(j?"bg-[#005496]":"bg-[#005496]/90"),children:[(0,n.jsx)("span",{className:"text-xl font-bold uppercase tracking-widest block mb-6 ".concat(j?"text-blue-100":"text-white/70"),children:"Accuracy Rate"}),(0,n.jsx)("div",{className:"text-8xl xl:text-9xl font-black leading-tight break-words text-center ".concat(j?"text-white":"text-white/50"),children:j?j.conf.toFixed(2):"-"})]})]})})]})}},7123:(e,t,l)=>{Promise.resolve().then(l.bind(l,6415))}},e=>{e.O(0,[441,255,358],()=>e(e.s=7123)),_N_E=e.O()}]);