(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{161:(e,r,t)=>{Promise.resolve().then(t.bind(t,6415))},6415:(e,r,t)=>{"use strict";t.d(r,{default:()=>l});var n=t(5155),o=t(2115);function a(){return"http://localhost:8000".replace(/\/+$/,"")}function l(){let e=(0,o.useMemo)(a,[]),r=(0,o.useMemo)(()=>(function(e){try{let r=new URL(e);return r.protocol="https:"===r.protocol?"wss:":"ws:",r.pathname="/ws-client",r.search="",r.toString()}catch(e){return"ws://localhost:8000/ws-client"}})(e),[e]),t=(0,o.useRef)(null),l=(0,o.useRef)(null),s=(0,o.useRef)(null),c=(0,o.useRef)(null),[i,d]=(0,o.useState)(!1),[u,m]=(0,o.useState)(null),[h,g]=(0,o.useState)(null),[x,b]=(0,o.useState)({w:0,h:0}),[f,p]=(0,o.useState)(null);(0,o.useEffect)(()=>{p(new Date);let e=setInterval(()=>p(new Date),1e3);return()=>clearInterval(e)},[]),(0,o.useEffect)(()=>{let e,n=!0,o={current:!0};return(async()=>{if(c.current&&(console.log("⚠️ Cleaning up old camera stream..."),c.current.getTracks().forEach(e=>e.stop()),c.current=null),s.current&&(console.log("⚠️ Cleaning up old WebSocket..."),s.current.close(),s.current=null),await new Promise(e=>setTimeout(e,100)),!o.current||!n)return console.log("\uD83D\uDED1 Component unmounted during startup");try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("Your browser doesn't support camera access");console.log("\uD83C\uDFA5 Requesting camera access...");let a=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"}});if(!n||!o.current){console.log("\uD83D\uDED1 Component unmounted after camera access"),a.getTracks().forEach(e=>e.stop());return}console.log("✅ Camera access granted"),c.current=a,t.current&&(t.current.srcObject=a),console.log("\uD83D\uDD0C Connecting to WebSocket:",r);let l=new WebSocket(r);s.current=l,l.onopen=()=>{console.log("✅ WebSocket connected"),d(!0),m(null)},l.onmessage=e=>{try{let t=JSON.parse(e.data);if("error"in t){var r;console.error("Server error:",t.error),m(null!=(r=t.error)?r:"Unknown server error")}else g(t)}catch(e){console.error("Failed to parse WS message:",e)}},l.onerror=e=>{console.error("❌ WebSocket error:",e),m("WebSocket connection error"),d(!1)},l.onclose=e=>{console.log("\uD83D\uDD0C WebSocket closed:",e.code,e.reason),d(!1)};let i=()=>{if(!n||!t.current||!l||l.readyState!==WebSocket.OPEN)return;let r=t.current;if(r.readyState===r.HAVE_ENOUGH_DATA){let e=document.createElement("canvas");e.width=r.videoWidth,e.height=r.videoHeight;let t=e.getContext("2d");t&&(t.drawImage(r,0,0),e.toBlob(e=>{if(e&&l.readyState===WebSocket.OPEN){let r=new FileReader;r.onloadend=()=>{let e=r.result.split(",")[1];l.send(JSON.stringify({image:e}))},r.readAsDataURL(e)}},"image/jpeg",.8))}setTimeout(()=>{e=requestAnimationFrame(i)},100)};i()}catch(r){console.error("❌ Camera error:",r);let e="Failed to access camera";r instanceof Error&&(e="NotAllowedError"===r.name||"PermissionDeniedError"===r.name?"Camera access denied. Please allow camera permission and reload the page.":"NotFoundError"===r.name||"DevicesNotFoundError"===r.name?"No camera found on your device.":"NotReadableError"===r.name||"TrackStartError"===r.name?"Camera is already in use. Please close other apps using the camera and reload the page.":"OverconstrainedError"===r.name?"Camera doesn't support the required settings.":"SecurityError"===r.name?"Camera access blocked by browser security policy.":r.message),m(e)}})(),()=>{console.log("\uD83E\uDDF9 Cleaning up camera and WebSocket..."),n=!1,o.current=!1,e&&cancelAnimationFrame(e),s.current&&(s.current.close(),s.current=null),c.current&&(c.current.getTracks().forEach(e=>e.stop()),c.current=null)}},[r]),(0,o.useEffect)(()=>{let e=t.current;if(!e)return;let r=()=>{let r=e.getBoundingClientRect();b({w:Math.round(r.width),h:Math.round(r.height)})};r();let n=new ResizeObserver(r);return n.observe(e),window.addEventListener("orientationchange",r),()=>{n.disconnect(),window.removeEventListener("orientationchange",r)}},[]),(0,o.useEffect)(()=>{h&&l.current&&x.w&&x.h&&function(e,r,t,n){let o=e.getContext("2d");if(!o)return;let a=Math.max(1,window.devicePixelRatio||1),l=Math.round(t*a),s=Math.round(n*a);(e.width!==l||e.height!==s)&&(e.width=l,e.height=s),e.style.width="".concat(t,"px"),e.style.height="".concat(n,"px"),o.clearRect(0,0,e.width,e.height),o.save(),o.scale(a,a);let c=t/r.width,i=n/r.height;o.lineWidth=2,o.font="12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto",r.detections.forEach(e=>{let r=e.box.x1*c,t=e.box.y1*i,n=e.box.x2*c,a=e.box.y2*i,l=n-r;o.strokeStyle="rgba(16,185,129,1)",o.strokeRect(r,t,l,a-t);let s="".concat(e.label," ").concat(e.conf.toFixed(2)),d=o.measureText(s).width;o.fillStyle="rgba(16,185,129,1)",o.fillRect(r,Math.max(0,t-16),d+8,16),o.fillStyle="rgba(0,0,0,1)",o.fillText(s,r+4,Math.max(14,t-2))}),o.restore()}(l.current,h,x.w,x.h)},[h,x]);let w=(0,o.useMemo)(()=>{let e=new Set;return null==h||h.detections.forEach(r=>e.add(r.label)),Array.from(e.values())},[h]),y=(0,o.useMemo)(()=>f?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",month:"2-digit",day:"2-digit",year:"numeric"}).format(f):null,[f]),v=(0,o.useMemo)(()=>f?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(f):null,[f]),k=y&&v?"".concat(y,"●").concat(v):null;return(0,n.jsx)("main",{className:"min-h-screen w-full text-gray-100 flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"w-full max-w-5xl",children:[u&&(0,n.jsx)("div",{className:"mb-4 p-4 bg-red-500/20 border border-red-500/40 rounded-lg text-red-200",children:u}),(0,n.jsxs)("div",{className:"relative mx-auto w-full",children:[(0,n.jsx)("div",{className:"absolute left-0 bottom-full mb-3 z-20",children:(0,n.jsx)("div",{className:"rounded-full bg-gray-900/70 border border-gray-800 px-3 py-2 backdrop-blur",children:w.length?(0,n.jsx)("div",{className:"flex flex-wrap gap-2 items-center",children:w.map((e,r)=>(0,n.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-purple-500/20 border border-purple-500/40 text-purple-200",children:["Location: ",e]},"".concat(e,"-").concat(r)))}):(0,n.jsx)("span",{className:"text-sm text-gray-400",children:"No detections"})})}),(0,n.jsx)("div",{className:"absolute right-0 bottom-full mb-3 z-20",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-gray-900/70 border border-gray-800 text-gray-200 backdrop-blur inline-flex items-center gap-1",children:[(0,n.jsxs)("svg",{"aria-hidden":!0,viewBox:"0 0 24 24",className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),(0,n.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,n.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,n.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),null!=k?k:"--/--/----●--:--:--"]}),(0,n.jsxs)("span",{className:"text-sm font-semibold px-2.5 py-1 rounded-full ".concat(i?"bg-[#CCF1C8] border-[#548664] text-[#36BC55]":"bg-gray-500/20 border-gray-500/40 text-gray-400"," border"),children:["● ",i?"LIVE":"CONNECTING"]})]})}),(null==h?void 0:h.latency_ms)&&(0,n.jsx)("div",{className:"absolute left-0 top-3 z-20",children:(0,n.jsxs)("span",{className:"text-xs font-medium px-2 py-1 rounded bg-black/50 border border-gray-700 text-gray-300 backdrop-blur",children:[h.latency_ms.toFixed(0),"ms"]})}),(0,n.jsxs)("div",{className:"relative rounded-2xl overflow-hidden shadow-2xl border border-gray-800 bg-black w-full",children:[(0,n.jsx)("video",{ref:t,autoPlay:!0,playsInline:!0,muted:!0,className:"block w-full h-auto object-contain select-none m-0"}),(0,n.jsx)("canvas",{ref:l,className:"pointer-events-none absolute inset-0","aria-hidden":!0})]})]})]})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=161)),_N_E=e.O()}]);