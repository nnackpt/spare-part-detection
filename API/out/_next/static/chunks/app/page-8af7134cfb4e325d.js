(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{161:(e,t,r)=>{Promise.resolve().then(r.bind(r,6415))},6415:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});var l=r(5155),s=r(2115);function n(){return"http://localhost:8000".replace(/\/+$/,"")}function a(){let e=(0,s.useMemo)(n,[]);(0,s.useMemo)(()=>(function(e){try{let t=new URL(e);return t.protocol="https:"===t.protocol?"wss:":"ws:",t.pathname="/ws-client",t.search="",t.toString()}catch(e){return"ws://localhost:8000/ws-client"}})(e),[e]);let t=(0,s.useMemo)(()=>(function(e){try{let t=new URL(e);return t.protocol="https:"===t.protocol?"wss:":"ws:",t.pathname="/ws",t.search="",t.toString()}catch(e){return"ws://localhost:8000/ws"}})(e),[e]),r=(0,s.useRef)(null),a=(0,s.useRef)(null),o=(0,s.useRef)(null);(0,s.useRef)(null);let[c,i]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),[h,m]=(0,s.useState)(null),[x,b]=(0,s.useState)({w:0,h:0}),[f,g]=(0,s.useState)(null),[p,w]=(0,s.useState)(!0),[y,v]=(0,s.useState)(!1);(0,s.useEffect)(()=>{g(new Date);let e=setInterval(()=>g(new Date),1e3);return()=>clearInterval(e)},[]),(0,s.useEffect)(()=>{let e,r=!0,l=()=>{let s=new WebSocket(t);o.current=s,s.onopen=()=>{console.log("✅ WebSocket connected"),i(!0),u(null),w(!1)},s.onmessage=e=>{try{let r=JSON.parse(e.data);if("error"in r){var t;u(null!=(t=r.error)?t:"Unknown error")}else m(r),u(null),b({w:r.width,h:r.height})}catch(e){console.error("Failed to parse WS message:",e)}},s.onerror=()=>{u("Cannot connect to server"),i(!1)},s.onclose=t=>{i(!1),r&&1e3!==t.code&&(u("Reconnecting..."),e=setTimeout(()=>{r&&l()},3e3))}};return l(),()=>{var t;r=!1,e&&clearTimeout(e),null==(t=o.current)||t.close(1e3)}},[t]),(0,s.useEffect)(()=>{let e=r.current;if(!e)return;let t=()=>{let t=e.getBoundingClientRect();b({w:Math.round(t.width),h:Math.round(t.height)})};t();let l=new ResizeObserver(t);return l.observe(e),window.addEventListener("orientationchange",t),()=>{l.disconnect(),window.removeEventListener("orientationchange",t)}},[]),(0,s.useEffect)(()=>{h&&a.current&&x.w&&x.h&&function(e,t,r,l){let s=e.getContext("2d");if(!s)return;let n=Math.max(1,window.devicePixelRatio||1),a=Math.round(r*n),o=Math.round(l*n);(e.width!==a||e.height!==o)&&(e.width=a,e.height=o),e.style.width="".concat(r,"px"),e.style.height="".concat(l,"px"),s.clearRect(0,0,e.width,e.height),s.save(),s.scale(n,n);let c=r/t.width,i=l/t.height;s.lineWidth=2,s.font="12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto",t.detections.forEach(e=>{let t=e.box.x1*c,r=e.box.y1*i,l=e.box.x2*c,n=e.box.y2*i,a=l-t;s.strokeStyle="rgba(16,185,129,1)",s.strokeRect(t,r,a,n-r);let o="".concat(e.label," ").concat(e.conf.toFixed(2)),d=s.measureText(o).width;s.fillStyle="rgba(16,185,129,1)",s.fillRect(t,Math.max(0,r-16),d+8,16),s.fillStyle="rgba(0,0,0,1)",s.fillText(o,t+4,Math.max(14,r-2))}),s.restore()}(a.current,h,x.w,x.h)},[h,x]);let N=(0,s.useMemo)(()=>{let e=new Set;return null==h||h.detections.forEach(t=>e.add(t.label)),Array.from(e.values())},[h]),j=(0,s.useMemo)(()=>f?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",month:"2-digit",day:"2-digit",year:"numeric"}).format(f):null,[f]),k=(0,s.useMemo)(()=>f?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(f):null,[f]),S=j&&k?"".concat(j,"●").concat(k):null;return(0,l.jsx)("main",{className:"min-h-screen w-full text-gray-100 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"w-full max-w-5xl",children:[p&&(0,l.jsx)("div",{className:"mb-4 p-4 bg-blue-500/20 border border-blue-500/40 rounded-lg text-blue-200",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Starting camera..."]})}),d&&(0,l.jsx)("div",{className:"mb-4 p-4 bg-red-500/20 border border-red-500/40 rounded-lg text-red-200",children:d}),(0,l.jsxs)("div",{className:"relative mx-auto w-full",children:[(0,l.jsx)("div",{className:"absolute left-0 bottom-full mb-3 z-20",children:(0,l.jsx)("div",{className:"rounded-full bg-gray-900/70 border border-gray-800 px-3 py-2 backdrop-blur",children:N.length?(0,l.jsx)("div",{className:"flex flex-wrap gap-2 items-center",children:N.map((e,t)=>(0,l.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-purple-500/20 border border-purple-500/40 text-purple-200",children:["Location: ",e]},"".concat(e,"-").concat(t)))}):(0,l.jsx)("span",{className:"text-sm text-gray-400",children:"No detections"})})}),(0,l.jsx)("div",{className:"absolute right-0 bottom-full mb-3 z-20",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-gray-900/70 border border-gray-800 text-gray-200 backdrop-blur inline-flex items-center gap-1",children:[(0,l.jsxs)("svg",{"aria-hidden":!0,viewBox:"0 0 24 24",className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,l.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),(0,l.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,l.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,l.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),null!=S?S:"--/--/----●--:--:--"]}),(0,l.jsxs)("span",{className:"text-sm font-semibold px-2.5 py-1 rounded-full ".concat(c?"bg-[#CCF1C8] border-[#548664] text-[#36BC55]":"bg-gray-500/20 border-gray-500/40 text-gray-400"," border"),children:["● ",c?"LIVE":"CONNECTING"]})]})}),(null==h?void 0:h.latency_ms)&&(0,l.jsx)("div",{className:"absolute left-0 top-3 z-20",children:(0,l.jsxs)("span",{className:"text-xs font-medium px-2 py-1 rounded bg-black/50 border border-gray-700 text-gray-300 backdrop-blur",children:[h.latency_ms.toFixed(0),"ms"]})}),(0,l.jsx)("div",{className:"relative rounded-2xl overflow-hidden shadow-2xl border border-gray-800 bg-black w-full",children:(0,l.jsx)("canvas",{ref:a,className:"block w-full h-auto",style:{aspectRatio:"16/9"}})})]})]})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=161)),_N_E=e.O()}]);