(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{161:(e,t,r)=>{Promise.resolve().then(r.bind(r,6415))},6415:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});var l=r(5155),n=r(2115);function s(){return"http://localhost:8000".replace(/\/+$/,"")}function a(){let e=(0,n.useMemo)(s,[]),t="".concat(e,"/stream.mjpg"),r=(0,n.useMemo)(()=>{let t=new URL(e);return t.protocol="https:"===t.protocol?"wss:":"ws:",t.pathname="/ws",t.toString()},[e]),a=(0,n.useRef)(null),o=(0,n.useRef)(null),[c,i]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[m,x]=(0,n.useState)(!0),[f,h]=(0,n.useState)(null),[p,b]=(0,n.useState)([]);(0,n.useEffect)(()=>{h(new Date);let e=setInterval(()=>h(new Date),1e3);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{let e=a.current;if(!e)return;let t=()=>{i(!0),x(!1),u(null)},r=()=>{i(!1),x(!1),u("Cannot connect to camera stream")};return e.addEventListener("load",t),e.addEventListener("error",r),()=>{e.removeEventListener("load",t),e.removeEventListener("error",r)}},[]),(0,n.useEffect)(()=>{let e,t=!0,l=()=>{let n=new WebSocket(r);o.current=n,n.onopen=()=>{console.log("✅ WebSocket connected")},n.onmessage=e=>{try{let t=JSON.parse(e.data);if(!("error"in t)&&t.detections){let e=Array.from(new Set(t.detections.map(e=>e.label)));b(e)}}catch(e){console.error("Failed to parse WS message:",e)}},n.onerror=()=>{console.error("WebSocket error")},n.onclose=r=>{t&&1e3!==r.code&&(e=setTimeout(()=>{t&&l()},3e3))}};return l(),()=>{var r;t=!1,e&&clearTimeout(e),null==(r=o.current)||r.close(1e3)}},[r]);let g=(0,n.useMemo)(()=>f?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",month:"2-digit",day:"2-digit",year:"numeric"}).format(f):null,[f]),v=(0,n.useMemo)(()=>f?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(f):null,[f]),w=g&&v?"".concat(g,"●").concat(v):null;return(0,l.jsx)("main",{className:"min-h-screen w-full text-gray-100 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"w-full max-w-3xl",children:[d&&(0,l.jsx)("div",{className:"mb-4 p-4 bg-red-500/20 border border-red-500/40 rounded-lg text-red-200",children:d}),(0,l.jsxs)("div",{className:"relative mx-auto w-full",children:[(0,l.jsx)("div",{className:"absolute left-0 bottom-full mb-3 z-20",children:(0,l.jsx)("div",{className:"rounded-full bg-gray-900/70 border border-gray-800 px-3 py-2 backdrop-blur",children:p.length?(0,l.jsx)("div",{className:"flex flex-wrap gap-2 items-center",children:p.map((e,t)=>(0,l.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-purple-500/20 border border-purple-500/40 text-purple-200",children:["Location: ",e]},"".concat(e,"-").concat(t)))}):(0,l.jsx)("span",{className:"text-sm text-gray-400",children:"No detections"})})}),(0,l.jsx)("div",{className:"absolute right-0 bottom-full mb-3 z-20",children:(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-gray-900/70 border border-gray-800 text-gray-200 backdrop-blur inline-flex items-center gap-1",children:[(0,l.jsxs)("svg",{"aria-hidden":!0,viewBox:"0 0 24 24",className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,l.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),(0,l.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,l.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,l.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),null!=w?w:"--/--/----●--:--:--"]})})}),(0,l.jsx)("div",{className:"relative rounded-2xl overflow-hidden shadow-2xl border border-gray-800 bg-black w-full",children:(0,l.jsx)("img",{ref:a,src:t,alt:"Live camera feed",className:"block w-full h-auto object-contain"})})]})]})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=161)),_N_E=e.O()}]);