(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{161:(e,t,r)=>{Promise.resolve().then(r.bind(r,6415))},6415:(e,t,r)=>{"use strict";r.d(t,{default:()=>o});var a=r(5155),n=r(2115);function l(){return"http://localhost:8000".replace(/\/+$/,"")}function o(){let e=(0,n.useMemo)(l,[]),t=(0,n.useMemo)(()=>(function(e){try{let t=new URL(e);return t.protocol="https:"===t.protocol?"wss:":"ws:",t.pathname="/ws-client",t.search="",t.toString()}catch(e){return"ws://localhost:8000/ws-client"}})(e),[e]),r=(0,n.useRef)(null),o=(0,n.useRef)(null),s=(0,n.useRef)(null),i=(0,n.useRef)(null),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(null),[h,x]=(0,n.useState)(null),[g,f]=(0,n.useState)({w:0,h:0}),[b,p]=(0,n.useState)(null),[w,y]=(0,n.useState)(!0),[v,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{p(new Date);let e=setInterval(()=>p(new Date),1e3);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{let e,a,n=!0,l=async()=>{y(!0);try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("Browser doesn't support camera access");let o=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"}});if(!n)return void o.getTracks().forEach(e=>e.stop());i.current=o,r.current&&(r.current.srcObject=o,r.current.onloadedmetadata=()=>{N(!0),y(!1),console.log("\uD83D\uDCF9 Camera ready")}),console.log("\uD83D\uDD0C Connecting to:",t);let c=new WebSocket(t);s.current=c,c.onopen=()=>{console.log("✅ WebSocket connected"),d(!0),m(null)},c.onmessage=e=>{try{let r=JSON.parse(e.data);if("error"in r){var t;console.error("❌ Server error:",r.error),m(null!=(t=r.error)?t:"Unknown error")}else x(r),m(null)}catch(e){console.error("Failed to parse WS message:",e)}},c.onerror=e=>{var r;console.error("❌ WebSocket error:",e),m("Cannot connect to ".concat((null==(r=t.split("://")[1])?void 0:r.split("/")[0])||"server")),d(!1)},c.onclose=e=>{console.log("\uD83D\uDD0C WebSocket closed:",e.code,e.reason),d(!1),n&&1e3!==e.code&&(m("Reconnecting..."),a=setTimeout(()=>{n&&l()},3e3))};let u=()=>{if(!n||!r.current||!c||c.readyState!==WebSocket.OPEN){e=requestAnimationFrame(u);return}let t=r.current;if(t.readyState===t.HAVE_ENOUGH_DATA){let e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight;let r=e.getContext("2d");r&&(r.drawImage(t,0,0),e.toBlob(e=>{if(e&&c.readyState===WebSocket.OPEN){let t=new FileReader;t.onloadend=()=>{let e=t.result.split(",")[1];c.send(JSON.stringify({image:e}))},t.readAsDataURL(e)}},"image/jpeg",.7))}setTimeout(()=>{e=requestAnimationFrame(u)},100)};u()}catch(e){console.error("❌ Camera error:",e),m(e instanceof Error?e.message:"Failed to access camera"),y(!1)}};return l(),()=>{var t,r;n=!1,e&&cancelAnimationFrame(e),a&&clearTimeout(a),null==(t=s.current)||t.close(1e3),null==(r=i.current)||r.getTracks().forEach(e=>e.stop())}},[t]),(0,n.useEffect)(()=>{let e=r.current;if(!e)return;let t=()=>{let t=e.getBoundingClientRect();f({w:Math.round(t.width),h:Math.round(t.height)})};t();let a=new ResizeObserver(t);return a.observe(e),window.addEventListener("orientationchange",t),()=>{a.disconnect(),window.removeEventListener("orientationchange",t)}},[]),(0,n.useEffect)(()=>{h&&o.current&&g.w&&g.h&&function(e,t,r,a){let n=e.getContext("2d");if(!n)return;let l=Math.max(1,window.devicePixelRatio||1),o=Math.round(r*l),s=Math.round(a*l);(e.width!==o||e.height!==s)&&(e.width=o,e.height=s),e.style.width="".concat(r,"px"),e.style.height="".concat(a,"px"),n.clearRect(0,0,e.width,e.height),n.save(),n.scale(l,l);let i=r/t.width,c=a/t.height;n.lineWidth=2,n.font="12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto",t.detections.forEach(e=>{let t=e.box.x1*i,r=e.box.y1*c,a=e.box.x2*i,l=e.box.y2*c,o=a-t;n.strokeStyle="rgba(16,185,129,1)",n.strokeRect(t,r,o,l-r);let s="".concat(e.label," ").concat(e.conf.toFixed(2)),d=n.measureText(s).width;n.fillStyle="rgba(16,185,129,1)",n.fillRect(t,Math.max(0,r-16),d+8,16),n.fillStyle="rgba(0,0,0,1)",n.fillText(s,t+4,Math.max(14,r-2))}),n.restore()}(o.current,h,g.w,g.h)},[h,g]);let j=(0,n.useMemo)(()=>{let e=new Set;return null==h||h.detections.forEach(t=>e.add(t.label)),Array.from(e.values())},[h]),k=(0,n.useMemo)(()=>b?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",month:"2-digit",day:"2-digit",year:"numeric"}).format(b):null,[b]),S=(0,n.useMemo)(()=>b?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(b):null,[b]),E=k&&S?"".concat(k,"●").concat(S):null;return(0,a.jsx)("main",{className:"min-h-screen w-full text-gray-100 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-5xl",children:[w&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-blue-500/20 border border-blue-500/40 rounded-lg text-blue-200",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Starting camera..."]})}),u&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-red-500/20 border border-red-500/40 rounded-lg text-red-200",children:u}),(0,a.jsxs)("div",{className:"relative mx-auto w-full",children:[(0,a.jsx)("div",{className:"absolute left-0 bottom-full mb-3 z-20",children:(0,a.jsx)("div",{className:"rounded-full bg-gray-900/70 border border-gray-800 px-3 py-2 backdrop-blur",children:j.length?(0,a.jsx)("div",{className:"flex flex-wrap gap-2 items-center",children:j.map((e,t)=>(0,a.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-purple-500/20 border border-purple-500/40 text-purple-200",children:["Location: ",e]},"".concat(e,"-").concat(t)))}):(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"No detections"})})}),(0,a.jsx)("div",{className:"absolute right-0 bottom-full mb-3 z-20",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-gray-900/70 border border-gray-800 text-gray-200 backdrop-blur inline-flex items-center gap-1",children:[(0,a.jsxs)("svg",{"aria-hidden":!0,viewBox:"0 0 24 24",className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),(0,a.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,a.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,a.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),null!=E?E:"--/--/----●--:--:--"]}),(0,a.jsxs)("span",{className:"text-sm font-semibold px-2.5 py-1 rounded-full ".concat(c?"bg-[#CCF1C8] border-[#548664] text-[#36BC55]":"bg-gray-500/20 border-gray-500/40 text-gray-400"," border"),children:["● ",c?"LIVE":"CONNECTING"]})]})}),(null==h?void 0:h.latency_ms)&&(0,a.jsx)("div",{className:"absolute left-0 top-3 z-20",children:(0,a.jsxs)("span",{className:"text-xs font-medium px-2 py-1 rounded bg-black/50 border border-gray-700 text-gray-300 backdrop-blur",children:[h.latency_ms.toFixed(0),"ms"]})}),(0,a.jsxs)("div",{className:"relative rounded-2xl overflow-hidden shadow-2xl border border-gray-800 bg-black w-full",children:[(0,a.jsx)("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"block w-full h-auto object-contain select-none m-0"}),(0,a.jsx)("canvas",{ref:o,className:"pointer-events-none absolute inset-0","aria-hidden":!0})]})]})]})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=161)),_N_E=e.O()}]);