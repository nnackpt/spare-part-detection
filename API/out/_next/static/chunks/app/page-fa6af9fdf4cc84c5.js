(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{161:(e,r,t)=>{Promise.resolve().then(t.bind(t,6415))},6415:(e,r,t)=>{"use strict";t.d(r,{default:()=>n});var s=t(5155),l=t(2115);function a(){return"http://localhost:8000".replace(/\/+$/,"")}function n(){let e=(0,l.useMemo)(a,[]),r="".concat(e,"/stream.mjpg"),t=(0,l.useMemo)(()=>(function(e){try{let r=new URL(e);return r.protocol="https:"===r.protocol?"wss:":"ws:",r.pathname="/ws",r.search="",r.toString()}catch(e){return"ws://localhost:8000/ws"}})(e),[e]),n=(0,l.useRef)(null),o=(0,l.useRef)(null),[c,i]=(0,l.useState)(!1),[d,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null),[h,b]=(0,l.useState)([]),[f,p]=(0,l.useState)(null);(0,l.useEffect)(()=>{p(new Date);let e=setInterval(()=>p(new Date),1e3);return()=>clearInterval(e)},[]),(0,l.useEffect)(()=>{let e=n.current;if(!e)return;let r=()=>{i(!0),x(null)},t=()=>{i(!1),x("Cannot connect to camera")};return e.addEventListener("load",r),e.addEventListener("error",t),()=>{e.removeEventListener("load",r),e.removeEventListener("error",t)}},[]),(0,l.useEffect)(()=>{let e,r=!0,s=()=>{let l=new WebSocket(t);o.current=l,l.onopen=()=>{u(!0)},l.onmessage=e=>{try{let r=JSON.parse(e.data);!r.error&&r.detections&&b(r.detections)}catch(e){console.error("WS parse error:",e)}},l.onerror=()=>u(!1),l.onclose=t=>{u(!1),r&&1e3!==t.code&&(e=setTimeout(()=>{r&&s()},3e3))}};return s(),()=>{var t;r=!1,e&&clearTimeout(e),null==(t=o.current)||t.close(1e3)}},[t]);let g=(0,l.useMemo)(()=>{let e=new Set;return h.forEach(r=>e.add(r.label)),Array.from(e.values())},[h]),y=(0,l.useMemo)(()=>f?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",month:"2-digit",day:"2-digit",year:"numeric"}).format(f):null,[f]),v=(0,l.useMemo)(()=>f?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(f):null,[f]),w=y&&v?"".concat(y,"●").concat(v):null,N=c&&d;return(0,s.jsx)("main",{className:"min-h-screen w-full bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-gray-100 flex items-center justify-center p-4 pb-20",children:(0,s.jsxs)("div",{className:"w-full max-w-6xl",children:[!N&&!m&&(0,s.jsx)("div",{className:"mb-4 p-4 bg-blue-500/20 border border-blue-500/40 rounded-lg text-blue-200",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Connecting to camera..."]})}),m&&(0,s.jsx)("div",{className:"mb-4 p-4 bg-red-500/20 border border-red-500/40 rounded-lg text-red-200",children:m}),(0,s.jsxs)("div",{className:"relative mx-auto w-full",children:[(0,s.jsx)("div",{className:"absolute left-0 bottom-full mb-3 z-20 max-w-[60%]",children:(0,s.jsx)("div",{className:"rounded-full bg-gray-900/80 border border-gray-700 px-3 py-2 backdrop-blur-sm",children:g.length>0?(0,s.jsx)("div",{className:"flex flex-wrap gap-2 items-center",children:g.map((e,r)=>(0,s.jsxs)("span",{className:"text-xs sm:text-sm font-medium px-2.5 py-1 rounded-full bg-purple-500/20 border border-purple-500/40 text-purple-200",children:["Location: ",e]},"".concat(e,"-").concat(r)))}):(0,s.jsx)("span",{className:"text-xs sm:text-sm text-gray-400",children:"No detections"})})}),(0,s.jsx)("div",{className:"absolute right-0 bottom-full mb-3 z-20",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-xs sm:text-sm font-medium px-2.5 py-1 rounded-full bg-gray-900/80 border border-gray-700 text-gray-200 backdrop-blur-sm inline-flex items-center gap-1",children:[(0,s.jsxs)("svg",{"aria-hidden":"true",viewBox:"0 0 24 24",className:"w-3 h-3 sm:w-4 sm:h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),(0,s.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,s.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,s.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),null!=w?w:"--/--/----●--:--:--"]}),(0,s.jsxs)("span",{className:"text-xs sm:text-sm font-semibold px-2.5 py-1 rounded-full ".concat(N?"bg-[#CCF1C8] border-[#548664] text-[#36BC55]":"bg-gray-500/20 border-gray-500/40 text-gray-400"," border"),children:["● ",N?"LIVE":"CONNECTING"]})]})}),(0,s.jsx)("div",{className:"relative rounded-2xl overflow-hidden shadow-2xl border border-gray-700 bg-black w-full aspect-video",children:(0,s.jsx)("img",{ref:n,src:r,alt:"Live camera feed",className:"block w-full h-full object-contain"})})]})]})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=161)),_N_E=e.O()}]);