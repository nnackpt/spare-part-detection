(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{161:(e,t,r)=>{Promise.resolve().then(r.bind(r,6415))},6415:(e,t,r)=>{"use strict";r.d(t,{default:()=>o});var n=r(5155),l=r(2115),s=r(5704);function a(){var e;return(null!=(e=s.env.NEXT_PUBLIC_API_BASE)?e:"http://localhost:8081").replace(/\/+$/,"")}function o(){let e=(0,l.useMemo)(a,[]),t=(0,l.useMemo)(()=>(function(e){try{let t=new URL(e);return t.pathname="/stream.mjpg",t.search="",t.toString()}catch(e){return"http://localhost:8081/stream.mjpg"}})(e),[e]),r=function(e){let[t,r]=(0,l.useState)(null),n=(0,l.useRef)(null),s=(0,l.useRef)(0);return(0,l.useEffect)(()=>{let t=!0,l=()=>{if(t)try{let a=new WebSocket(e);n.current=a,a.onopen=()=>{s.current=0},a.onmessage=e=>{try{let t=JSON.parse(e.data);r(t)}catch(e){}},a.onclose=()=>{if(!t)return;let e=Math.min(1e3*2**s.current,8e3);s.current+=1,setTimeout(l,e)},a.onerror=()=>{a.close()}}catch(t){let e=Math.min(1e3*2**s.current,8e3);s.current+=1,setTimeout(l,e)}};return l(),()=>{t=!1;try{var e;null==(e=n.current)||e.close()}catch(e){}}},[e]),t}((0,l.useMemo)(()=>(function(e){try{let t=new URL(e);return t.protocol="https:"===t.protocol?"wss:":"ws:",t.pathname="/ws",t.search="",t.toString()}catch(e){return"ws://localhost:8081/ws"}})(e),[e])),s=(0,l.useRef)(null),o=(0,l.useRef)(null),[i,c]=(0,l.useState)({w:0,h:0}),[u,d]=(0,l.useState)(null);(0,l.useEffect)(()=>{d(new Date);let e=setInterval(()=>d(new Date),1e3);return()=>clearInterval(e)},[]),(0,l.useEffect)(()=>{let e=s.current;if(!e)return;let t=()=>{let t=e.getBoundingClientRect();c({w:Math.round(t.width),h:Math.round(t.height)})};t();let r=new ResizeObserver(t);return r.observe(e),window.addEventListener("orientationchange",t),()=>{r.disconnect(),window.removeEventListener("orientationchange",t)}},[]),(0,l.useEffect)(()=>{if(!r)return;let e=o.current,t=s.current;e&&t&&i.w&&i.h&&function(e,t,r,n){let l=e.getContext("2d");if(!l)return;let s=Math.max(1,window.devicePixelRatio||1),a=Math.round(r*s),o=Math.round(n*s);(e.width!==a||e.height!==o)&&(e.width=a,e.height=o),e.style.width="".concat(r,"px"),e.style.height="".concat(n,"px"),l.clearRect(0,0,e.width,e.height),l.save(),l.scale(s,s);let i=r/t.width,c=n/t.height;l.lineWidth=2,l.font="12px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto",t.detections.forEach(e=>{let t=e.box.x1*i,r=e.box.y1*c,n=e.box.x2*i,s=e.box.y2*c,a=n-t;l.strokeStyle="rgba(16,185,129,1)",l.strokeRect(t,r,a,s-r);let o="".concat(e.label," ").concat(e.conf.toFixed(2)),u=l.measureText(o).width;l.fillStyle="rgba(16,185,129,1)",l.fillRect(t,Math.max(0,r-16),u+8,16),l.fillStyle="rgba(0,0,0,1)",l.fillText(o,t+4,Math.max(14,r-2))}),l.restore()}(e,r,i.w,i.h)},[r,i]);let h=(0,l.useMemo)(()=>{let e=new Set;return null==r||r.detections.forEach(t=>e.add(t.label)),Array.from(e.values())},[r]),m=(0,l.useMemo)(()=>u?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",month:"2-digit",day:"2-digit",year:"numeric"}).format(u):null,[u]),x=(0,l.useMemo)(()=>u?new Intl.DateTimeFormat("en-US",{timeZone:"Asia/Bangkok",hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(u):null,[u]),f=m&&x?"".concat(m,"●").concat(x):null;return(0,n.jsx)("main",{className:"min-h-screen w-full text-gray-100 flex items-center justify-center p-4",children:(0,n.jsx)("div",{className:"w-full max-w-5xl",children:(0,n.jsxs)("div",{className:"relative mx-auto w-full",children:[(0,n.jsx)("div",{className:"absolute left-0 bottom-full mb-3 z-20",children:(0,n.jsx)("div",{className:"rounded-full bg-gray-900/70 border border-gray-800 px-3 py-2 backdrop-blur",children:h.length?(0,n.jsx)("div",{className:"flex flex-wrap gap-2 items-center",children:h.map((e,t)=>(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-purple-500/20 border border-purple-500/40 text-purple-200",children:["Location: ",e]})},"".concat(e,"-").concat(t)))}):(0,n.jsx)("span",{className:"text-sm text-gray-400",children:"No detections"})})}),(0,n.jsx)("div",{className:"absolute right-0 bottom-full mb-3 z-20",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("span",{className:"text-sm font-medium px-2.5 py-1 rounded-full bg-gray-900/70 border border-gray-800 text-gray-200 backdrop-blur inline-flex items-center gap-1",children:[(0,n.jsxs)("svg",{"aria-hidden":!0,viewBox:"0 0 24 24",className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2"}),(0,n.jsx)("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),(0,n.jsx)("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),(0,n.jsx)("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),null!=f?f:"--/--/----●--:--:--"]}),(0,n.jsx)("span",{className:"text-sm font-semibold px-2.5 py-1 rounded-full bg-[#CCF1C8] border border-[#548664] text-[#36BC55]",children:"● LIVE"})]})}),(0,n.jsxs)("div",{className:"relative rounded-2xl overflow-hidden shadow-2xl border border-gray-800 bg-black w-full",children:[(0,n.jsx)("img",{ref:s,src:t,alt:"YOLO stream",className:"block w-full h-auto object-contain select-none m-0",draggable:!1}),(0,n.jsx)("canvas",{ref:o,className:"pointer-events-none absolute inset-0","aria-hidden":!0})]})]})})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=161)),_N_E=e.O()}]);